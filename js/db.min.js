define("utils",[],function(){return{combilePath:function(){for(var t,n=(arguments[0]||"").toString(),i=1;i<arguments.length;i++)t=(arguments[i]||"").toString(),t.length&&(n[n.length-1]==="/"&&t[0]==="/"?n=n.substring(0,n.length-1)+t:n[n.length-1]!=="/"&&t[0]!=="/"?n=n+"/"+t:n+=t);return n},paramsFromRoute:function(n){for(var r=/:(\w+)/g,t,i=[];t=r.exec(n);)i.push({replace:t[0],key:t[1]});return i},dateFormat:function(n,t){var i,r;t=t?new Date(t):new Date;i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(r in i)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[r]:("00"+i[r]).substr((""+i[r]).length)));return n}}});define("DataBase",["Q","utils","config","md5","jquery"],function(n,t,i,r){return function(u){function e(n){return function(t,i,r,u){var e={};n(e,t);f.request(t,e,n,i,r,u)}}var f=this;f.timeout=5e3;f.moduleName=u.id;f.apiPath="";f.call=function(t,i){return n.promise(function(n,r,u){var o=f[t],e;f.resolve=n;f.reject=r;typeof o=="function"?f[t](i,n,r,u):(e="",e=f.moduleName?"名为"+t+"的方法不存在":"名为"+f.moduleName+"."+t+"的方法不存在",r(new Error("名为"+t+"的方法不存在")))})};f.request=function(n,u,e,o,s){function v(){var u=new Date,f=u.getHours(),e=(new Date).setHours(f-1),o=(new Date).setHours(f+1),n="yyyy-MM-dd hh",i="m123456-",s=[r(i+t.dateFormat(n,e)),r(i+t.dateFormat(n,u)),r(i+t.dateFormat(n,o))];return s.join(",")}var h=f.path,c=$.extend({method:"GET",dataType:"json"},u);h=t.combilePath(i.apiPath||i.api,h);c.url&&(h=t.combilePath(h,c.url));$.each(t.paramsFromRoute(h),function(){var t=n[this.key];if(t!==undefined)h=h.replace(this.replace,t),delete n[this.key];else throw new Error("未提供参数"+this.replace);});var a=eval("("+localStorage.auth+")")||{},y={app:"m","api-key":v(),"access-token":a.accessToken,uid:a.userId},l={method:c.method,url:h,data:n,dataType:c.dataType,headers:y,timeout:f.timeout};switch(c.method){case"POST":l.data=JSON.stringify(l.data);l.contentType="application/json; charset=utf-8"}$.ajax(l).done(function(n,t,i){typeof e=="function"&&e(n,t,i);o(n,t,i)}).fail(function(n,t,i){n&&n.status==400&&s(n,t,i);s(new Error(n.responseText||t=="timeout"?"请求超时,当前超时时间为:"+f.timeout+"毫秒":t+":"+i))})};f.wrap=function(){function r(n){for(var t=0;t<i.length;t++)if(n==i[t])return!0;return!1}var i=["call","request","wrap"],n,t;for(n in f)r(n)||(t=f[n],typeof t=="function"&&(f[n]=e(t)));return f}}});define("db",["require","Q"],function(n,t){function i(i,r,u){var o=function(){},e,h,f;typeof u=="function"&&(o=u);o(!0);var s=[].concat(i),l=[].concat(r),c=[];for(e=0;e<s.length;e++)h=s[e].split("."),s[e]="db."+h[0],h.length>1?c.push(h[1]):c.push("");return f=t.defer(),n(s,function(){function r(n){f.reject(n)}for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n].call(c[n],l[n]));i.length==1?i[0].then(f.resolve).fail(r).finally(function(){o(!1)}).done():t.all(i).then(f.resolve).fail(r).finally(function(){o(!1)}).done()},f.reject),f.promise}function r(n,t){for(var f=i[n]={},u=[].concat(t),r=0;r<u.length;r++)(function(){var t=u[r];f[t]=function(r){return i(n+"."+t,r)}})()}return r("auth",["login"]),i});define("db.auth",["DataBase","module"],function(n,t){var i=new n(t);return i.path="/authentication",i.login=function(n){n.method="POST"},i.wrap()});